<!DOCTYPE html>
<html>
<head>
    <title>SNAC Admin: {{ data.title }}</title>

<!-- JQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css" integrity="sha384-aUGj/X2zp5rLCbBxumKTCw2Z50WgIr1vs/PFN4praOTvYXWlVyh2UtNUU0KAUhAX" crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ==" crossorigin="anonymous"></script>

<!-- Helper Scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.7.5/js/bootstrap-select.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.7.5/css/bootstrap-select.min.css">
<script language="javascript">
$('.selectpicker').selectpicker();
</script>

<!-- Select Upgrades -->
<link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.2-rc.1/css/select2.min.css" rel="stylesheet" />
<script src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.2-rc.1/js/select2.min.js"></script>
<link rel="stylesheet" href="{{control.snacURL}}/css/select2-bootstrap.min.css">

<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

<!-- Datatables -->
<link rel="stylesheet" href="//cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css">
<script src="//cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>

<!-- SNAC Styles -->
<link rel="stylesheet" href="{{control.snacURL}}/css/snac.css{{control.noCache}}">

<!-- SNAC Javascript -->
<script src="{{control.snacURL}}/javascript/admin.js{{control.noCache}}"></script>
<script src="{{control.snacURL}}/javascript/save_actions.js{{control.noCache}}"></script>
<script src="{{control.snacURL}}/javascript/select_loaders.js{{control.noCache}}"></script>
<script src="{{control.snacURL}}/javascript/scripts.js{{control.noCache}}"></script>
<script src="{{control.snacURL}}/javascript/relation_search.js{{control.noCache}}"></script>

<script>

$(document).ready(function() {

    // Use select2 to display the select dropdowns
    // rather than the HTML default
    $("select").each(function() {
        select_replace_simple($(this));
    });

    // Load the table into a datatable
    $('.table').DataTable();
});
</script>
</head>
<body role="document">
{% from 'page_navigation.html' import topNavigation,footer %}
{{ topNavigation(X, user, permissions, control) }}


<div class="container snac" role="main">
    <h1>Administrator: {{ data.title }}</h1>

    <ol class="breadcrumb">
        <li><a href="{{control.snacURL}}/administrator/dashboard">Administrator</a></li>
        <li>{{ data.title }}</li>
    </ol>

    <div class="row">
        <div class="alert alert-01 alert-info" id="status-message" style="display: none">
            <p></p>
        </div><!-- end alert -->
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="well well-lg">
                <p><span style="font-weight: bold;">Instructions: </span>This page shows all Constellations currently checked out or edited by any user.  Use the "Action" links to the right of any Constellation to view the published version, view the current user's in-progress version, unlock the constellation if the user is currently editing, or reassign the constellation to be edited by another user. </p>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="form-horizontal">

                        <table class="table">
                            <thead>
                                <tr>
                                    <th style="width: 40%">Constellation</th>
                                    <th style="width: 20%">Status</th>
                                    <th style="width: 20%">User</th>
                                    <th class="text-right" style="width: 20%">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for userpair in data.results %}
                                    {% for constellation in userpair.constellations %}
                                    <tr id="constellation_{{constellation.id}}">
                                        <td>{{constellation.nameEntries.0.original}}</td>
                                        <td id="status_{{constellation.id}}">{{constellation.status}}</td>
                                        <td id="constellation_username_{{constellation.id}}">{{userpair.user.fullName}}</td>
                                        <td class="text-right">
                                            <input type="hidden" id="constellation_version_{{constellation.id}}" value="{{constellation.version}}">
                                            <div class="btn-group" role="group" aria-label="Actions">
                                                <a href="{{control.snacURL}}/details/{{constellation.id}}" class="btn btn-info" title="Published Version"><span  class="fa fa-file" aria-hidden="true"></span></a>
                                                <a href="{{control.snacURL}}/details/{{constellation.id}}/{{constellation.version}}?preview=1" class="btn btn-success" title="Preview"><span  class="fa fa-eye" aria-hidden="true"></span></a>
                                                <a href="#" class="btn btn-danger" title="Reassign" onClick="reassignConstellation({{constellation.id}},$('#constellation_version_{{constellation.id}}').val()); return false;"><span  class="fa fa-retweet" aria-hidden="true"></span></a>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
        <div class="modal fade" id="usersPane" tabindex="-1" role="dialog" aria-labelledby="usersPaneLabel">
            <div class="modal-dialog" role="document" style="width: 60%;">
                <div class="modal-content">
                    <div class="modal-header primary">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="usersPaneLabel">Reassign Constellation</h4>
                    </div>
                    <div class="modal-body">
                        <div class="well well-lg">
                            <p><span style="font-weight: bold;">Instructions: </span> Select the user to whom you would like to reassign this Constellation.  Once you click "Reassign" below, the Constellation will be checked out to the chosen user.</p>
                        </div>
                        <div id="usersPaneContent">
                            <p class='text-center'>Loading...</p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-dismiss="modal" onClick="doReassignConstellation(false);">Reassign</button>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
{{ footer(X, user, permissions, control) }}
</body>
</html>

