<!DOCTYPE html>
<html>
<head>
<title>Edit a resource</title>

<!-- JQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css" integrity="sha384-aUGj/X2zp5rLCbBxumKTCw2Z50WgIr1vs/PFN4praOTvYXWlVyh2UtNUU0KAUhAX" crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ==" crossorigin="anonymous"></script>

<!-- Helper Scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.7.5/js/bootstrap-select.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.7.5/css/bootstrap-select.min.css">
<script language="javascript">
$('.selectpicker').selectpicker();
</script>

<!-- Select Upgrades -->
<link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.2-rc.1/css/select2.min.css" rel="stylesheet" />
<script src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.2-rc.1/js/select2.min.js"></script>
<link rel="stylesheet" href="{{control.snacURL}}/css/select2-bootstrap.min.css">

<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

<!-- Datatables -->
<link rel="stylesheet" href="//cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css">
<script src="//cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>

<!-- SNAC Styles -->
<link rel="stylesheet" href="{{control.snacURL}}/css/snac.css{{control.noCache}}">

<!-- SNAC Javascript -->
<script src="{{control.snacURL}}/javascript/admin.js{{control.noCache}}"></script>
<script src="{{control.snacURL}}/javascript/save_actions.js{{control.noCache}}"></script>
<script src="{{control.snacURL}}/javascript/select_loaders.js{{control.noCache}}"></script>
<script src="{{control.snacURL}}/javascript/scripts.js{{control.noCache}}"></script>
<script src="{{control.snacURL}}/javascript/relation_search.js{{control.noCache}}"></script>


<script>
    $(document).ready(function() {

        // Use select2 to display the select dropdowns
        // rather than the HTML default

        $('select').each(function() {
            $(this).select2({
                minimumResultsForSearch: Infinity,
                allowClear: false,
                theme: 'bootstrap'
            });
        });

        // Load the table into a datatable
        var datatable = $('.table').DataTable({
            "searching": false
        });

        $('#searchbutton').click(function() {
            searchResource();
            return false;
        });

        $("#edit-resource-btn").click(function() {
            $('#resourceEditPane').modal("show")
        });


        function searchResource() {
            resourceResults = null;
            $.post("{{control.snacURL}}/resource_search?count=100", $("#search-form").serialize(), function(data) {
                resourceResults = data;
                var results = [];
                // console.log($("#search_form").serialize());
                // console.log(data);
                datatable.clear();
                if (data.results.length > 0) {
                    for (var key in data.results) {
                        var result = data.results[key];
                        var editIcon = "<a href ='{{control.snacURL}}/vocab_administrator/edit_resource/" 
                            + result.id + "/" + result.version + "'> <i class='fa fa-edit'></i> </a>";
                        var title = result.title || "";
                        var type = result.documentType.term || "";
                        var abstract = result.abstract || "";
                        var href = result.link || ""
                        href = "<a href=" + href + " target='_blank'>" + href + "</a>";
                        
                        var repo = result.repository || "" 
                        var holdingInstitution = ""
                        if (repo) {        
                            var holdingInstitution = repo.nameEntries[0].original || ""
                            var holding_href = repo.ark || ""
                            holdingInstitution = "<a href=" + holding_href + " target='_blank'>"
                            + holdingInstitution + "</a>";
                        }
                        var row = new Array(editIcon, title, abstract, href, holdingInstitution, type);
                        datatable.row.add(row);
                    }
                }
                datatable.draw();
            });
        };

    });
</script>

</head>

<body role="document">
    {% from 'page_navigation.html' import topNavigation,footer %} {{ topNavigation(X, user, permissions, control) }}

    <div class="container snac" role="main">
        <h1>Resource Management</h1>

        <ol class="breadcrumb">
            <li><a href="{{control.snacURL}}/vocab_administrator/dashboard">Vocabulary</a></li>
            <li>Resource Management</li>
        </ol>

        <div class="row">
            <div class="col-md-12">
                <div class="well well-lg">
                    <p><span style="font-weight: bold;">Instructions: </span>Search for existing resources. Only the top 100 results will be shown.</p>
                </div>


                <form class="form-horizontal" id="search-form" method="GET">
                    <div class="well well-lg text-center">
                        <div class="input-group select2-bootstrap-append">
                            <select name="filters[type_id]" style="width: 25%;">
                                <!-- TODO: enable search filters by type  -->
                                <option value="696" selected>Archival Resource</option>
                                <option value="697">Bibliographic Resource</option>
                                <option value="400479">Digital Archival Resource</option>
                            </select>
                            <input type="text" class="form-control" placeholder="Search for..." 
                                id="searchbox" name="term" style="width: 75%" value="">
                            <span class="input-group-btn">
    					    <button class="btn btn-default" id="searchbutton">Search</button>
						    </span>
                        </div>
                    </div>
                </form>

                <div class="text-center">
                    <a href="{{control.snacURL}}/vocab_administrator/add_resource" class="btn btn-success">
                        <i class="fa fa-fw fa-plus"></i> Add New Resource
                    </a>
                </div>

                <div class="form-horizontal">
                    <table class="table">
                        <thead>
                            <tr>
                                <th></th>
                                <th>Title</th>
                                <th>Abstract</th>
                                <th>HREF</th>
                                <th>Holding Institution</th>
                                <th>Type</th>
                            </tr>
                        </thead>
                        <tbody id="resourceList">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>


        <!-- <button type="button" class="btn btn-primary" name="button" id="edit-resource-btn"> Edit Resource</button>
        
        <div class="modal fade" id="resourceEditPane" tabindex="-1" role="dialog" aria-labelledby="resourceEditPane">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header primary">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="resourceEditLabel">Edit Resource</h4>
                    </div>
                    <div class="modal-body" id="resourceEditPaneContent">
                        <form class="form-horizontal" id="resource_create_form" onsubmit="return false;">
                            <div class="modal-body">
                                <p>Use this form to edit the resource</p>
        	                    <div id="resource-create-box">
        	                    </div>
                            </div>
                        </form>
                        
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Cancel</span></button>
                        <button type="button" class="btn btn-primary" id="btn_create_resource" data-dismiss="modal">Save</button>
                    </div>
                </div>
            </div>
        </div> -->

    
    {{ footer(X, user, permissions, control) }}
</body>
</html>
